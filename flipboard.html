<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<script src="asset/script/jquery.js"></script>
	<script src="hammer/jquery.hammer.js"></script>
	<title>flipboard效果实现</title>
	<style>
		article{
			width: 100%;
			height: 300px;
			margin: 300px 0 0 0;
			background: url(./asset/img/weather_real.jpg) 50% 50%;
			-webkit-transform-origin: 50% 0;
			/*-webkit-backface-visibility: hidden;*/
		}
	</style>
</head>
<body>
	<article>
	</article>
	<script>
		$(document).hammer().on('drag', function( event ){
			event.gesture.preventDefault();
		});

		var art = $('article');
		var YRange = 400;
		var sCoord = {};
		var eCoord = {};
		art.hammer().on('dragstart',function( e ){
			sCoord.x = e.gesture.deltaX;
			sCoord.y = e.gesture.deltaY;
		});
		art.hammer().on('drag',function( e ){
			setTimeout(function(){
				snatchyChangeEndCoord(e);
				changeTrans( sCoord, eCoord );
			}, 100);

			function snatchyChangeEndCoord( e ){
				eCoord.x = e.gesture.deltaX;
				eCoord.y = e.gesture.deltaY;
			}
			
		});
		art.hammer().on('dragend',function( e ){
			eCoord.x = e.gesture.deltaX;
			eCoord.y = e.gesture.deltaY;

			chkWhileEnd(sCoord, eCoord );
		});

		function changeTrans( sCrd, cCrd){
			
			var dvY = cCrd.y - sCrd.y;
			var dvX = cCrd.x - sCrd.x;
			if( Math.abs( dvX/dvY ) < 1 ){
				if( dvY < 0 ){
					if( dvY < YRange )
					var tansDeg = -dvY/YRange * 180;
					var transV = 'perspective(600px) rotateX(' + tansDeg + 'deg)';
					// console.log( transV );
					art.css('webkitTransform', transV);
					// console.log( art.css('webkitTransform') );
				}
				
			}
		}

		function chkWhileEnd( sCrd, eCrd){
			var dvY = eCrd.y - sCrd.y;
			var dvX = eCrd.x - sCrd.x;
			art.css('webkitTransition', 'all 200ms ease');
			if( Math.abs( dvX/dvY ) < 1 ){
				if( dvY < 0 ){
					if( -dvY > YRange/2 ){
						var transV = 'perspective(600px) rotateX(180deg)';
						// console.log( transV );

						art.css('webkitTransform', transV);
						console.log( art.css('webkitTransform') );
					}
					else{
						var transV = 'perspective(600px) rotateX(0deg)';
						// console.log( transV );
						art.css('webkitTransform', transV);
						console.log( art.css('webkitTransform') );
					}
					
				}
				
			}
		}

	</script>
</body>
</html>